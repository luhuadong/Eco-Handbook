# sustainable-software

[Carbon-Aware vs. Carbon-Efficient Applications](https://devblogs.microsoft.com/sustainable-software/carbon-aware-vs-carbon-efficient-applications/?WT.mc_id=green-8661-cxa)



## 介绍

可持续软件工程是一门结合了气候科学、软件、硬件、电力市场和数据中心设计的新兴学科。 可持续软件工程的原则和理念是定义、构建和运行可持续软件应用程序所需的一系列核心能力。 通过综合这些知识，可持续软件工程师 (SSE) 可以做出对应用程序碳污染有重大影响的决策。

### 学习目标

学完本模块后，你将能够：

- 确定可持续软件工程的八项原则
- 了解可持续软件工程的两大理念

### 先决条件

- 熟悉一般计算概念





## 可持续软件工程原则

可持续软件工程是一门结合了气候科学、软件、硬件、电力市场和数据中心设计的新兴学科。 可持续软件工程原则是定义、构建和运行可持续软件应用程序所需的一系列核心能力。



### 可持续软件工程的八项原则

可持续软件工程有八项原则，这些原则形成了对何谓可持续软件工程师的共同理解。 本模块的后续单元将逐一概述这些原则。

1. **碳** ：构建具有碳效率的应用程序。
2. **电** ：构建节能型应用程序。
3. **碳强度** ：以最低的碳强度消耗电力。
4. **隐含碳** ：构建硬件高效型应用程序。
5. **能量均衡** ：最大限度地提高硬件能效。
6. **网络** ：减少数据量和数据在网络中的传输距离。
7. **需求调整** ：构建碳感知型应用程序。
8. **优化** ：注重循序渐进的优化，提高总体碳效率。

这八项原则独立于：

- 应用程序域。
- 组织规模或类型。
- 云供应商或自承载。
- 编程语言或框架。

### 可持续软件工程的两大理念

除了八项原则外，可持续软件工程还有两大理念。

1. **每个人都可以在解决气候问题上发挥作用**

    如果你正在阅读本文档，并认同自己是环保人士，请知晓，你正在参与一场关心环保并积极行动的大规模全球运动。 在工程设计的各个领域，从设计硅片到设计用户体验，环保人士无处不在。

    任何事物都不是孤立存在的，都和外界有着千丝万缕的联系，并且牵一发而动全身。 即使只是在技术会议上让可持续性话题常态化，也会给其他人带来畅所欲言的机会。 这就是你为组织带来变革的方式。

    作为可持续软件工程师，我们相信每个人都可以在解决气候问题上发挥作用。 可持续软件工程包罗万象。 不管是哪个部门、哪个行业、哪个角色、哪种技术 - 你总能做一些事情来产生影响。

2. **可持续发展本身就足以证明我们的工作是正确的**

    作为可持续软件工程师，我们认识到，构建可持续应用程序可以带来很多好处。 它们几乎总是更便宜，性能更出色，复原能力更强。 但我们实践可持续软件工程的主要原因是为了实现可持续发展，其他都是附加优势。



## 原则 1：碳

对环保的理解常常因人而异，这对于沟通和决定要优化的内容很有挑战性。 对于可持续软件工程，我们的关注点是碳，这也是为什么可持续软件工程的第一项原则是构建具有碳效率的应用程序。

### 什么是碳？

温室气体 (GHG) 就像一张毯子，使地球温度升高，这是一种自然现象。 然而，由于人类活动的影响，全球气候的变化速度远远超过了动植物的适应能力。 人类社会如何适应气候变化仍是一个悬而未决的问题。

GHG 有很多种。 最常见的是二氧化碳 (CO2)。 为了便于计算，我们将所有 GHG 数字标准化为二氧化碳当量 (CO2eq)。 例如，一吨甲烷与大约 25 吨 CO2 具有相同的升温效果，所以我们将其标准化为 25 吨 CO2eq。 我们甚至可以进一步简化为碳，这通常用来指所有 GHG。

### 净零碳目标

由 [UN IPCC](https://www.theguardian.com/environment/2011/dec/06/what-is-ipcc) 设定、195 个国家/地区在[巴黎气候协定](https://unfccc.int/process-and-meetings/the-paris-agreement/the-paris-agreement)中同意并批准的目标是减少碳污染，以便到 2100 年，与工业化前的水平相比，温度上升稳定在 1.5°C 以内。

地球上的温度上升取决于大气中的碳总量，而不是碳的排放速度。 为了彻底阻止温度上升的速度，我们需要停止向大气中增加碳，或者实现净零排放。

净零排放意味着每排放一克碳，便提取一克碳，所以大气中碳的总体质量是固定不变的。

为了实现这一目标，我们需要立即开始减少碳排放，到 2030 年减少 45%，到 2050 年实现净零排放。

### 不浪费每一克碳

我们总是通过各种活动排放碳；我们的目标是确保从排放到大气中的每一克碳中尽可能提取最大的价值。

实现碳效率就是要把单位工作的碳排放量降到最低。

在工程领域，我们在解决气候问题上发挥的作用就是构建具有碳效率的应用程序。 具有碳效率是指构建能够为你或你的用户增加相同价值，但碳排放更少的应用程序。



## 原则 2：电

### 电和碳

大多数人认为电是干净的；当我们把插头插到墙上时，我们的手不会变脏，我们的笔记本电脑也不需要排气管。 然而，事实是，大多数电是通过燃烧化石燃料产生的，[通常指煤](https://ourworldindata.org/grapher/world-electricity-by-source)，而能源供应是导致碳排放的[最大](https://www.eea.europa.eu/data-and-maps/daviz/change-of-co2-eq-emissions-2#tab-chart_4)原因。

我们可以在电和碳排放之间画一条直线，因此，电可以说是碳的代用指标之一。

从智能手机上运行的应用程序，到数据中心运行的机器学习模型的训练，所有软件在执行过程中都会消耗电力。 减少软件的电力消耗以及由此产生的碳污染排放的最佳方法之一就是让应用程序更加节能。

这就是为什么可持续软件工程的第二项原则是构建节能型应用程序。

作为可持续工程师，我们需要了解电；这一旅程并不是从电脑开始，而是从为电脑提供动力的电是如何产生的开始。

### 能量与功率

能量是一种衡量用电量的指标，能量的标准单位是焦耳 (J)。不过，另一种常见的能源消耗方式是以千瓦时 (kWh) 为单位。

电量经常被报告为功率或能量，这是两个不同的概念：

能量 = 功率 ✕ 时间

- 能量是指总用电量，能量的标准单位是焦耳 (J)。
- 功率是指单位时间内消耗的电能率，功率的标准单位是瓦 (W)。1 瓦就是每秒 1 焦耳。

一种常见的能源消耗方式是单位时间内的功率，如瓦秒或千瓦时。 例如：

- 20 瓦秒 (20 Ws) 是指一件功率为 20 W 的电器运行一秒钟所消耗的电量。 因为 1 瓦是每秒 1 焦耳，所以这里是 20 焦耳。

- 20 千瓦时 (20 kWh) 是指一件功率为 20,000 瓦的电器运行一小时所消耗的能量。

    能量 = 60 ✕ 60 ✕ 20,000 = 72,000,000 焦耳 = 72 兆焦 (72 MJ)



## 原则 3：碳强度

电的碳强度用于衡量每消耗一千瓦时电所产生的碳 (CO2eq) 排放量。

碳强度的标准单位是 gCO2eq/kWh，即每千瓦时碳的克数。

并非所有电力都以相同的方式产生。 在不同的地方和不同的时间，利用不同的能源发电，其碳排放量也不尽相同。 有些能源，如风能、太阳能或水力发电，是清洁的可再生能源，不排放碳。 其他化石燃料能源则会排放不同数量的碳来发电。 例如，燃烧天然气的发电厂比燃烧煤炭的发电厂排放的碳更少。

如果你的电脑直接由水电站供电，那么它所消耗的电力的碳强度为零 gCO2eq/kWh。 水电站发电是不排碳的。 大多数人不能直接接入水电站， 而是接入电网，由产生不同碳量的混合能源提供电力。 因此，当接入电网时，碳强度通常大于零。

### 碳强度的可变性

碳强度因地点不同而变化，因为有些地区的混合能源比其他地区含有更多的清洁能源。

由于可再生能源的可变性，碳强度也会随时间而变化。 例如，当天气阴暗或无风时，碳强度会增加，因为在你的混合能源中，更多的电力来自于排放碳的能源。

![](https://docs.microsoft.com/zh-cn/learn/modules/sustainable-software-engineering-overview/media/5-carbon-intensity-1.svg)

在一天当中，电力需求会不断变化，而这种需求需要通过能源供应来满足。 有些能源供应很容易控制它所产生的电力；例如，煤电厂可以少烧煤。 有些能源供应不能轻易控制它所产生的电力；例如，风力发电场不能控制风的大小，它只能丢弃（缩减）基本上是免费生产的电力。

![](https://docs.microsoft.com/zh-cn/learn/modules/sustainable-software-engineering-overview/media/5-carbon-intensity-2.svg)

作为能源市场运作方式的副产品，随着电力需求的下降，通常情况下，高排放的化石燃料能源会先被缩减，可再生能源会在最后被缩减。

减少应用程序的用电量可以降低当地电网混合能源的碳强度。

### 边际碳强度

如果你选择消耗更多能量，这些能量就来自于边际电厂。 这个电厂可以控制它所输出的能量，而可再生能源不能控制太阳或风，因此边际电厂往往由化石燃料提供动力。

边际电厂会排放碳。无论何时，电网中的混合能源都具有碳强度，为了满足新需求而必须使用的能源也具有碳强度，后者称为边际碳强度。

化石燃料发电厂的碳强度很难缩减为零，它们有一个最低的运行门槛。 有的根本不缩减，它们被认为是稳定可用的的基本负荷。 正因为如此，我们有时会遇到一种反常的情况，即，丢弃（缩减）免费生产的可再生能量，以消耗化石燃料发电厂用花了钱的燃料生产的能量。

![](https://docs.microsoft.com/zh-cn/learn/modules/sustainable-software-engineering-overview/media/5-carbon-intensity-3.svg)

如果一个新的负荷将由本来会被缩减的可再生能源供应来满足，那么边际碳强度将为零 gCO2eq/kWh。

有时，电的边际碳强度为零 gCO2eq/kWh，如果在这种时候运行计算，所消耗的电力不会排放碳。

### 需求转移

目前，电网系统中几乎没有储能或缓冲的方式。 通常情况下，电力的生产使供应总能满足需求。 如果可再生能源产生的能量超过了支持需求所需的能量，而我们所有的储能系统都已储满，我们就会缩减（丢弃）这些清洁能量。 一种解决方案是将工作负荷转移到可再生能源供应较多的时间和地点，这就是所谓的需求转移。

如果你能灵活控制工作负荷的运行时间和地点，就可以选择在碳强度较低时用电，在碳强度较高时暂停。 例如，在碳强度更低的其他时间或地区训练机器学习模型。

诸如 [Putting a CO2 figure on a piece of computation](https://ieeexplore.ieee.org/document/6128960)（某项计算的 CO2 图）之类的研究表明，这些做法可使碳减排量高达 45% 到 99%，具体取决于为电网供电的可再生能源数量。

全方位审视你的应用程序，找出灵活运行工作负荷的机会，并使用电的碳强度来指示何时或是否运行这些工作负荷。

![](https://docs.microsoft.com/zh-cn/learn/modules/sustainable-software-engineering-overview/media/5-carbon-intensity-4.svg)

### 计算碳强度

许多服务允许你获取不同电网当前碳强度的实时数据。 有些提供未来碳强度的估计值；有些提供边际碳强度。

- [碳强度 API](https://carbonintensity.org.uk/)：英国碳强度数据的免费资源。
- [ElectricityMap](https://api.electricitymap.org/)：针对非商业性的单一国家/地区使用，提供免费解决方案；针对商业性和多个国家/地区使用，提供高级解决方案。
- [WattTime](https://www.watttime.org/)：针对单电网地区提供免费解决方案，针对多电网地区提供高级解决方案，并提供实时边际排放量。



